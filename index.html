<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>å¹¸ç¦æ•™é¤Šå·¥å…·ç®±ï½œæ¨¡çµ„1ï½œå¤§äººå…ˆç©© v1.0</title>

  <meta name="theme-color" content="#f0a04b" />
  <meta name="background-color" content="#fff8ee" />
  <meta name="description" content="æ¨¡çµ„1ï½œç¾å ´æ€¥æ•‘Ã—éŒ¦å›Šå¦™è¨ˆÃ—æ¯æ—¥ç·´åŠŸÃ—å›é¥‹çå‹µ" />

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <style>
    :root{
      --bg1:#fff2df;
      --bg2:#ffe8f3;
      --ink:#2b2a26;
      --muted:#6c5d4b;
      --brand:#ff8a3d;
      --brand2:#ffd166;
      --mint:#3dd6a6;
      --sky:#5aa9ff;
      --pink:#ff6fb1;
      --card:#ffffff;
      --shadow:0 12px 28px rgba(0,0,0,.10);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 10% 0%, var(--bg2), transparent 60%),
        radial-gradient(1200px 600px at 90% 0%, #e9fff6, transparent 55%),
        var(--bg1);
    }

    .app{max-width: 860px; margin:0 auto; padding:16px;}
    .hidden{display:none !important;}

    /* Topbar */
    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding:8px 4px 6px;
    }
    .title{font-size:20px; font-weight:1000; letter-spacing:.5px;}
    .sub{margin-top:4px; color:var(--muted); font-weight:900; font-size:13px; line-height:1.4;}
    .topbarBtns{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}

    /* Cards */
    .card{
      background: var(--card);
      border-radius: var(--r);
      padding: 16px;
      margin: 14px 0;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,.05);
    }
    .h2{margin:0 0 10px; font-size:18px; font-weight:1000;}
    .h3{margin:0 0 8px; font-size:14px; font-weight:1000; color:var(--ink);}
    .tiny{margin:10px 0 0; color:var(--muted); font-weight:900; font-size:13px; line-height:1.5;}

    /* Hero */
    .hero{
      background:
        radial-gradient(800px 240px at 20% 0%, rgba(255,111,177,.20), transparent 60%),
        radial-gradient(800px 240px at 85% 0%, rgba(61,214,166,.18), transparent 60%),
        #fff;
    }
    .heroTitle{font-size:20px; font-weight:1000; margin-bottom:10px;}

    /* Quotes */
    .quote{
      background: linear-gradient(180deg, rgba(255,138,61,.14), rgba(255,255,255,1));
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 14px;
      padding: 12px;
      line-height: 1.6;
      font-weight: 900;
      min-height: 46px;
    }

    /* Layout */
    .row{display:flex; gap:10px; margin-top: 12px; flex-wrap:wrap;}
    .twoCols{display:grid; grid-template-columns:1fr; gap:14px;}
    @media (min-width: 720px){
      .twoCols{grid-template-columns:1fr 1fr;}
    }

    /* Timer */
    .timerRow{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    .timer{
      font-size:34px;
      font-weight:1000;
      letter-spacing:1px;
    }
    .phase{
      font-weight:1000;
      color:var(--muted);
      background: rgba(255,255,255,.9);
      border:1px solid rgba(0,0,0,.08);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
    }

    /* Reward */
    .badgeRow{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    .badge{
      display:inline-block;
      font-size: 12px;
      font-weight: 1000;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,138,61,.16);
      border: 1px solid rgba(255,138,61,.28);
    }
    .bar{
      height: 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.08);
      overflow:hidden;
      margin: 12px 0 8px;
    }
    .fill{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, var(--mint), var(--brand2), var(--pink));
    }
    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      font-weight:1000;
      color:var(--muted);
    }

    /* Buttons */
    .btn{
      flex:1;
      min-width: 160px;
      padding: 12px 12px;
      font-size: 16px;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      color: #1d1b16;
      font-weight: 1000;
      cursor:pointer;
      box-shadow: 0 12px 18px rgba(255,138,61,.22);
    }
    .btn:active{transform: translateY(1px)}
    .btn.ghost{
      background:#fff;
      color:var(--ink);
      border:1px solid rgba(0,0,0,.12);
      box-shadow:none;
    }
    .btn.small{
      min-width:auto;
      padding:8px 10px;
      font-size:13px;
      border-radius:12px;
      flex:0 0 auto;
    }
    .btn.big{
      width:100%;
      min-width: 100%;
      padding: 14px 14px;
      font-size: 17px;
    }

    .footer{
      padding: 10px 4px 24px;
      text-align:center;
      color:var(--muted);
      font-weight:900;
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="topbar">
      <div>
        <div class="title">å¹¸ç¦æ•™é¤Šå·¥å…·ç®±</div>
        <div class="sub">æ¨¡çµ„1ï½œå¤§äººå…ˆç©©ï¼šæ€¥æ•‘ Ã— éŒ¦å›Š Ã— æ¯æ—¥ç·´åŠŸ</div>
      </div>
      <div class="topbarBtns">
        <button class="btn ghost small" data-action="openFeedback" type="button">å›é¥‹è¡¨å–®</button>
        <button class="btn ghost small" data-action="toggleHelp" type="button">å®‰è£æ•™å­¸</button>
      </div>
    </header>

    <!-- å¿«é€Ÿå…¥å£ -->
    <section class="card hero">
      <div class="heroTitle">ç¾åœ¨å…ˆè®“è‡ªå·±ç©©å®šä¸€é»</div>
      <button class="btn big" data-action="startRescue" type="button">æ’ä¸ä½äº†ï½œå…ˆæ€¥æ•‘</button>
      <div class="tiny">å…ˆåš 30 ç§’å°±å¥½ã€‚åšå®Œå†èªªã€‚</div>
    </section>

    <!-- 1 ç¾å ´æ€¥æ•‘ -->
    <section class="card rescue">
      <div class="h2">1ï½œç¾å ´æ€¥æ•‘ï¼ˆ30 ç§’ï¼‰</div>

      <div class="quote" id="rescueLine">æŒ‰ä¸Šé¢çš„ã€Œå…ˆæ€¥æ•‘ã€ï¼Œå°±æœƒé–‹å§‹ã€‚</div>

      <div class="timerRow">
        <div class="timer" id="timerText">00:30</div>
        <div class="phase" id="phaseText">æº–å‚™</div>
      </div>

      <div class="row">
        <button class="btn" data-action="startRescue" type="button">é–‹å§‹</button>
        <button class="btn ghost" data-action="stopRescue" type="button">åœæ­¢</button>
        <button class="btn ghost" data-action="logDone" data-kind="rescue" type="button">å®Œæˆä¸€æ¬¡æ€¥æ•‘</button>
      </div>

      <div class="tiny">æç¤ºï¼šå¸ 4 ç§’ã€å 6 ç§’ï¼Œè·Ÿè‘—èµ°å°±å¥½ã€‚</div>
    </section>

    <!-- 2 éŒ¦å›Šå¦™è¨ˆ -->
    <section class="card tips">
      <div class="h2">2ï½œéŒ¦å›Šå¦™è¨ˆ</div>

      <div class="twoCols">
        <div>
          <div class="h3">å¿ƒè£¡æƒ³çš„ï¼ˆå…ˆè®“å¿ƒè£¡ç©©å®šä¸€é»ï¼‰</div>
          <button class="btn" data-action="pickInner" type="button">çµ¦ä¸€å¥</button>
          <div class="quote" id="innerOut">ï¼ˆæœƒå‡ºç¾ä¸€å¥å…§åœ¨æç¤ºï¼‰</div>
        </div>
        <div>
          <div class="h3">èªªå‡ºå£çš„ï¼ˆç¾åœ¨èªªå¾—å‡ºå£çš„è©±ï¼‰</div>
          <button class="btn" data-action="pickOuter" type="button">çµ¦ä¸€å¥</button>
          <div class="quote" id="outerOut">ï¼ˆæœƒå‡ºç¾ä¸€å¥å¯èªªå‡ºå£çš„è©±ï¼‰</div>
        </div>
      </div>

      <div class="row">
        <button class="btn ghost" data-action="logDone" data-kind="tips" type="button">ç”¨äº†ä¸€æ¬¡éŒ¦å›Š</button>
      </div>
    </section>

    <!-- 3 æ¯æ—¥ç·´åŠŸ -->
    <section class="card practice">
      <div class="h2">3ï½œæ¯æ—¥ç·´åŠŸï¼ˆé»ä¸€ä¸‹å°±ç®—ï¼‰</div>
      <div class="quote" id="dailyQ">ï¼ˆä»Šå¤©ç·´åŠŸé¡Œç›®æœƒå‡ºç¾åœ¨é€™è£¡ï¼‰</div>

      <div class="row">
        <button class="btn" data-action="dailyPick" data-choice="done" type="button">æœ‰åšåˆ°</button>
        <button class="btn" data-action="dailyPick" data-choice="almost" type="button">å·®ä¸€é»</button>
        <button class="btn" data-action="dailyPick" data-choice="next" type="button">ä¸‹æ¬¡å†ç·´</button>
      </div>

      <div class="tiny">ä¸æ‰“å¡ã€ä¸è©•åˆ†ï¼›é¡˜æ„å›ä¾†å°±å¾ˆå¥½ã€‚</div>
    </section>

    <!-- 4 å›é¥‹çå‹µ -->
    <section class="card reward">
      <div class="h2">4ï½œå›é¥‹çå‹µ</div>

      <div class="badgeRow">
        <span class="badge" id="presenceBadge">æœ€è¿‘æœ‰å›ä¾†</span>
        <span class="tiny" id="presenceText">é¡˜æ„å›ä¾†ï¼Œå°±åœ¨è·¯ä¸Šã€‚</span>
      </div>

      <div class="bar">
        <div class="fill" id="seedFill"></div>
      </div>
      <div class="meta">
        <span id="seedMeta">ç´¯ç©ï¼š0</span>
        <button class="btn ghost small" data-action="softReset" type="button">è¼•æ¸…ç©º</button>
      </div>

      <div class="quote" id="praiseOut">ï¼ˆå®Œæˆä»»ä¸€é …æœƒå‡ºç¾å›é¥‹ï¼‰</div>

      <div class="tiny">æƒ³è®“å·¥å…·æ›´å¥½ç”¨ï¼šå¯ä»¥é»å³ä¸Šè§’ã€Œå›é¥‹è¡¨å–®ã€ã€‚</div>
    </section>

    <!-- å®‰è£æ•™å­¸ -->
    <section class="card hidden" id="helpBox">
      <div class="h2">ğŸ“² åŠ åˆ°æ‰‹æ©Ÿä¸»ç•«é¢ï¼ˆåƒ App ä¸€æ¨£ç”¨ï¼‰</div>

      <div class="quote">
        <div class="h3">Androidï¼ˆChromeï¼‰</div>
        <div class="tiny">
          1ï¸âƒ£ é»å³ä¸Šè§’ã€Œâ‹®ã€<br/>
          2ï¸âƒ£ é¸ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€<br/>
          3ï¸âƒ£ å¦‚æœæ˜¯åˆ¥äººå‚³çš„é€£çµï¼š<br/>
          ğŸ‘‰ å…ˆæŠŠç¶²å€è¤‡è£½ï¼Œè²¼åˆ° Chrome æ‰“é–‹ï¼Œå†åŠ åˆ°ä¸»ç•«é¢
        </div>
      </div>

      <div class="quote" style="margin-top:12px;">
        <div class="h3">iPhoneï¼ˆSafariï¼‰</div>
        <div class="tiny">
          1ï¸âƒ£ ç”¨ Safari æ‰“é–‹é€™å€‹ç¶²å€<br/>
          2ï¸âƒ£ é»ä¸‹æ–¹ã€Œåˆ†äº«ã€<br/>
          3ï¸âƒ£ é¸ã€ŒåŠ å…¥ä¸»ç•«é¢ã€<br/>
          ğŸ‘‰ å¦‚æœæ˜¯å¾ Line æˆ–å…¶ä»– App é»é€²ä¾†ï¼š<br/>
          å»ºè­°æŠŠç¶²å€è¤‡è£½ï¼Œè²¼åˆ° Safari æ‰“é–‹å†æ“ä½œ
        </div>
      </div>

      <div class="tiny">åŠ ä¸åŠ éƒ½æ²’é—œä¿‚ï¼Œç”¨å¾—é †æ¯”è¼ƒé‡è¦ã€‚</div>

      <div class="row">
        <button class="btn" id="btnInstall" disabled type="button">ä¸€éµåŠ å…¥ï¼ˆå¯ç”¨æœƒäº®ï¼‰</button>
        <button class="btn ghost" data-action="toggleHelp" type="button">é—œé–‰</button>
      </div>
    </section>

    <footer class="footer">
      v1.0ï½œæ¨¡çµ„1é‡å¯«ç‰ˆï¼ˆç©©å®šå¯ç”¨ï¼‰ï½œå¹¸ç¦æ•™é¤Šå·¥å…·ç®±
    </footer>
  </div>

  <script>
    // âœ… ä½ æŠŠå›é¥‹è¡¨å–®ç¶²å€è²¼åœ¨é€™è£¡ï¼ˆGoogle Forms / Typeform / ä»»ä½•ç¶²å€éƒ½å¯ï¼‰
    const FEEDBACK_URL = "https://forms.gle/ä½ çš„è¡¨å–®ç¶²å€";

    // --- SW è¨»å†Š ---
    (function registerSW(){
      if (!("serviceWorker" in navigator)) return;
      window.addEventListener("load", async () => {
        try { await navigator.serviceWorker.register("./sw.js"); } catch(e) {}
      });
    })();

    const LS_KEY = "HP_TOOLBOX_M1_V1";
    const nowISO = () => new Date().toISOString();

    const TEXT = {
      m1: {
        inner: [
          "å…ˆè®“è‡ªå·±ç©©å®šä¸€é»ã€‚",
          "æœ‰é»æ’ï¼Œå…ˆç·©ä¸€ä¸‹ã€‚",
          "å…ˆæ·±å‘¼å¸å¹¾ä¸‹å°±å¥½ã€‚",
          "å…ˆè®“æƒ…ç·’æ…¢ä¸‹ä¾†ã€‚",
          "äº‹æƒ…ç­‰ç­‰å†è™•ç†ã€‚",
          "å…ˆç«™ç©©ï¼Œå†æƒ³ä¸‹ä¸€æ­¥ã€‚",
          "æ…¢ä¸€é»ä¹Ÿæ²’é—œä¿‚ã€‚",
          "å…ˆåœä¸€ä¸‹ï¼Œè…¦å­æ‰è·Ÿå¾—ä¸Šã€‚",
          "å…ˆå–å£æ°´ã€æ›å£æ°£ã€‚",
          "å…ˆæŠŠè²éŸ³æ”¾å°ä¸€é»ã€‚",
          "å…ˆæŠŠè‚©è†€æ”¾é¬†ã€‚",
          "å…ˆè®“å¿ƒè·³æ…¢ä¸€é»ã€‚",
          "å…ˆè®“è‡‰æ”¾é¬†ã€‚",
          "å…ˆå›åˆ°å‘¼å¸ï¼Œä¸‹ä¸€å¥å†èªªã€‚",
          "å…ˆè®“è‡ªå·±å›ä¾†ã€‚",
          "å…ˆè®“æ°£é †ä¸€é»ã€‚",
          "å…ˆçµ¦è‡ªå·±ä¸€é»ç©ºé–“ã€‚",
          "å…ˆæŠŠé€Ÿåº¦æ”¾æ…¢ã€‚",
          "å…ˆæŠŠé‡é»æ”¾åœ¨ç•¶ä¸‹ã€‚",
          "å…ˆæŠŠå¿ƒç©©å®šä¸‹ä¾†ã€‚"
        ],
        outer: [
          "å…ˆåœä¸€ä¸‹ï¼Œç­‰ç­‰å†èªªã€‚",
          "éœ€è¦å…ˆæ•´ç†ä¸€ä¸‹ï¼Œç­‰ä¸€ä¸‹ã€‚",
          "æœ‰è½åˆ°ï¼Œçµ¦ä¸€é»æ™‚é–“ã€‚",
          "é€™ä»¶äº‹æ™šä¸€é»å†è™•ç†ã€‚",
          "å…ˆç·©ä¸€ç·©ã€‚",
          "å…ˆå®‰éœä¸€ä¸‹ã€‚",
          "å…ˆå–å£æ°´ï¼Œç­‰ä¸€ä¸‹å†è«‡ã€‚",
          "å…ˆå»æ´—æŠŠè‡‰ï¼Œç­‰ä¸€ä¸‹å›ä¾†ã€‚",
          "å…ˆå›æˆ¿é–“ä¸€ä¸‹ï¼Œç­‰ä¸€ä¸‹å†å›ä¾†ã€‚",
          "å…ˆåä¸‹ä¾†ï¼Œæ…¢ä¸€é»ã€‚",
          "å…ˆæŠŠè²éŸ³æ”¾å°ä¸€é»å†è«‡ã€‚",
          "å…ˆè®“å‘¼å¸æ…¢ä¸‹ä¾†ï¼Œå†è¬›ã€‚",
          "å…ˆåˆ°é€™è£¡ï¼Œç­‰ä¸€ä¸‹å†æ¥ã€‚",
          "å…ˆä¼‘æ¯ä¸€ä¸‹ï¼Œç­‰ä¸€ä¸‹å†ç¹¼çºŒã€‚",
          "å…ˆæŠŠæ‰‹ä¸Šçš„äº‹æ”¾ä¸‹ä¾†ï¼Œç­‰ä¸€ä¸‹å†èªªã€‚"
        ],
        praise: [
          "å‰›å‰›æœ‰åœä¸€ä¸‹ï¼Œç¾å ´å°±æ”¹è®Šäº†ã€‚",
          "é¡˜æ„å…ˆç·©ä¸€ç·©ï¼Œå·²ç¶“å¾ˆæœ‰åŠ›é‡ã€‚",
          "æœ‰å›ä¾†ç”¨å·¥å…·ï¼Œå°±å¾ˆäº†ä¸èµ·ã€‚",
          "èƒ½è®“è‡ªå·±ç©©å®šä¸€é»ï¼Œå­©å­æ‰æœ‰ä¾é ã€‚",
          "å…ˆç…§é¡§å¥½ç‹€æ…‹ï¼Œå¾Œé¢æ‰å¥½èªªè©±ã€‚",
          "æ…¢ä¸‹ä¾†çš„é‚£ä¸€åˆ»ï¼Œå°±æ˜¯è½‰æŠ˜é»ã€‚"
        ],
        dailyPractice: [
          "ä»Šå¤©æœ‰æ²’æœ‰å…ˆæ·±å‘¼å¸å†å›æ‡‰ï¼Ÿ",
          "ä»Šå¤©æœ‰æ²’æœ‰æŠŠéŸ³é‡æ”¾å°å†èªªï¼Ÿ",
          "ä»Šå¤©æœ‰æ²’æœ‰å…ˆåœä¸‰ç§’å†è¬›ï¼Ÿ",
          "ä»Šå¤©æœ‰æ²’æœ‰å…ˆé›¢é–‹åç§’å†å›ä¾†ï¼Ÿ",
          "ä»Šå¤©æœ‰æ²’æœ‰å…ˆå–å£æ°´å†è™•ç†ï¼Ÿ",
          "ä»Šå¤©æœ‰æ²’æœ‰å…ˆæŠŠé€Ÿåº¦æ”¾æ…¢ï¼Ÿ"
        ]
      }
    };

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    const state = loadState();

    function defaultState(){
      return {
        version: "1.0",
        lastUsedAt: null,
        count: 0,
        history: [] // {t, kind}
      };
    }
    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        return raw ? { ...defaultState(), ...JSON.parse(raw) } : defaultState();
      }catch{ return defaultState(); }
    }
    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

    // --- å›é¥‹ UI ---
    function updateRewardUI(){
      const badge = document.getElementById("presenceBadge");
      const text = document.getElementById("presenceText");
      const fill = document.getElementById("seedFill");
      const meta = document.getElementById("seedMeta");

      const now = Date.now();
      const last = state.lastUsedAt ? new Date(state.lastUsedAt).getTime() : null;
      const recent = last && (now - last <= 72*3600*1000);

      badge.textContent = recent ? "æœ€è¿‘æœ‰å›ä¾†" : "æƒ³èµ·ä¾†å°±å¥½";
      text.textContent = recent ? "é¡˜æ„å›ä¾†ï¼Œå°±åœ¨è·¯ä¸Šã€‚" : "ä¸ç”¨è£œä½œæ¥­ï¼Œå›ä¾†å°±å¥½ã€‚";

      const pct = Math.min(100, Math.round((state.count/60)*100));
      fill.style.width = pct + "%";
      meta.textContent = `ç´¯ç©ï¼š${state.count}`;
    }

    function praise(msg){
      const out = document.getElementById("praiseOut");
      out.textContent = msg || pick(TEXT.m1.praise);
    }

    function logDone(kind){
      state.count += 1;
      state.lastUsedAt = nowISO();
      state.history.push({ t: state.lastUsedAt, kind });
      if(state.history.length > 200) state.history = state.history.slice(-200);
      saveState();
      praise();
      toast(pick(TEXT.m1.praise));
      updateRewardUI();
    }

    // --- Toast ---
    let toastTimer = null;
    function toast(msg){
      let el = document.getElementById("toast");
      if(!el){
        el = document.createElement("div");
        el.id = "toast";
        Object.assign(el.style, {
          position:"fixed", left:"50%", bottom:"20px", transform:"translateX(-50%)",
          background:"rgba(43,42,38,.92)", color:"#fff",
          padding:"10px 12px", borderRadius:"14px",
          fontWeight:"900", fontSize:"13px",
          boxShadow:"0 10px 25px rgba(0,0,0,.20)", zIndex:"9999",
          maxWidth:"92vw", textAlign:"center"
        });
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.display = "block";
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> el.style.display="none", 2000);
    }

    // --- æ€¥æ•‘è¨ˆæ™‚ï¼ˆç”¨æ™‚é–“æˆ³å·®å€¼ï¼Œåˆ‡èƒŒæ™¯ä¹Ÿæº–ï¼‰ ---
    let rescueTimerId = null;
    let rescueEndAt = null;
    const TOTAL_MS = 30 * 1000;

    function setTimerUI(msLeft, phase){
      const t = document.getElementById("timerText");
      const p = document.getElementById("phaseText");
      const sec = Math.ceil(msLeft/1000);
      const mm = String(Math.floor(sec/60)).padStart(2,"0");
      const ss = String(sec%60).padStart(2,"0");
      t.textContent = `${mm}:${ss}`;
      p.textContent = phase;
    }

    function stopRescue(){
      if(rescueTimerId) clearInterval(rescueTimerId);
      rescueTimerId = null;
      rescueEndAt = null;
      setTimerUI(TOTAL_MS, "æº–å‚™");
    }

    function startRescue(){
      document.getElementById("rescueLine").textContent = pick(TEXT.m1.inner);

      if(rescueTimerId) clearInterval(rescueTimerId);
      const startAt = Date.now();
      rescueEndAt = startAt + TOTAL_MS;

      rescueTimerId = setInterval(()=>{
        const now = Date.now();
        const left = Math.max(0, rescueEndAt - now);

        const elapsed = now - startAt;
        const cycle = 10 * 1000;
        const pos = elapsed % cycle;
        const phase = pos < 4*1000 ? "å¸æ°£ï¼ˆ4ï¼‰" : "åæ°£ï¼ˆ6ï¼‰";

        setTimerUI(left, phase);

        if(left <= 0){
          stopRescue();
          document.getElementById("rescueLine").textContent = pick(TEXT.m1.praise);
          logDone("rescue");
        }
      }, 200);
    }

    // --- æ¯æ—¥ç·´åŠŸ ---
    function loadDailyQ(){
      document.getElementById("dailyQ").textContent = pick(TEXT.m1.dailyPractice);
    }
    function dailyPick(choice){
      const msg = choice === "done"
        ? "ä»Šå¤©æœ‰åšåˆ°ï¼Œå¤ªå¥½äº†ã€‚"
        : choice === "almost"
          ? "å·®ä¸€é»ä¹Ÿç®—ç·´åˆ°äº†ã€‚"
          : "æƒ³èµ·ä¾†å°±ç·´ä¸€ä¸‹ï¼Œå‰›å‰›é€™ä¸€æ­¥å°±å¾ˆå¥½ã€‚";
      toast(msg);
      praise(msg);
      logDone("daily");
      loadDailyQ();
    }

    // --- éŒ¦å›Šè¼¸å‡º ---
    function pickInner(){
      const s = pick(TEXT.m1.inner);
      document.getElementById("innerOut").textContent = s;
      praise("å…ˆè®“å¿ƒè£¡ç©©å®šä¸€é»ï¼Œå¾Œé¢æ‰å¥½èªªè©±ã€‚");
    }
    function pickOuter(){
      const s = pick(TEXT.m1.outer);
      document.getElementById("outerOut").textContent = s;
      praise("æœ‰ä¸€å¥èªªå¾—å‡ºå£çš„è©±ï¼Œç¾å ´å°±èƒ½æ’ä½ã€‚");
    }

    // --- è¼•æ¸…ç©º ---
    function softReset(){
      state.count = 0;
      saveState();
      toast("å·²è¼•æ¸…ç©ºå›é¥‹ï¼ˆå…§å®¹ä¿ç•™ï¼‰");
      updateRewardUI();
    }

    // --- å®‰è£æç¤º ---
    let deferredPrompt = null;
    function setupInstall(){
      const helpBox = document.getElementById("helpBox");
      const btnInstall = document.getElementById("btnInstall");

      window.addEventListener("beforeinstallprompt", (e)=>{
        e.preventDefault();
        deferredPrompt = e;
        btnInstall.disabled = false;
      });

      btnInstall.addEventListener("click", async ()=>{
        if(!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        btnInstall.disabled = true;
      });

      window.__toggleHelp = () => helpBox.classList.toggle("hidden");
    }

    // --- å›é¥‹è¡¨å–® ---
    function openFeedback(){
      // é¿å…ä½ å¿˜äº†æ”¹ç¶²å€ï¼šå…ˆä¿è­·ä¸€ä¸‹
      if(!FEEDBACK_URL || FEEDBACK_URL.includes("ä½ çš„è¡¨å–®ç¶²å€")){
        toast("è«‹å…ˆåœ¨ç¨‹å¼è£¡è²¼ä¸Šå›é¥‹è¡¨å–®ç¶²å€ï¼ˆFEEDBACK_URLï¼‰");
        return;
      }
      window.open(FEEDBACK_URL, "_blank", "noopener,noreferrer");
    }

    // --- äº‹ä»¶å§”æ´¾ ---
    document.addEventListener("click", (e)=>{
      const btn = e.target.closest("[data-action]");
      if(!btn) return;

      const act = btn.dataset.action;

      if(act === "startRescue") return startRescue();
      if(act === "stopRescue") return stopRescue();
      if(act === "pickInner") return pickInner();
      if(act === "pickOuter") return pickOuter();
      if(act === "softReset") return softReset();
      if(act === "toggleHelp") return window.__toggleHelp?.();
      if(act === "openFeedback") return openFeedback();

      if(act === "logDone") return logDone(btn.dataset.kind || "manual");
      if(act === "dailyPick") return dailyPick(btn.dataset.choice || "next");
    });

    (function init(){
      setupInstall();
      updateRewardUI();
      loadDailyQ();
      setTimerUI(TOTAL_MS, "æº–å‚™");
    })();
  </script>
</body>
  </html>
